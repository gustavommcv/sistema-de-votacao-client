<div class="poll-detail-container">
  <div *ngIf="loading" class="loading">Carregando enquete...</div>

  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="poll" class="poll-detail">
    <h1>{{ poll.title }}</h1>

    <div class="poll-meta">
      <span
        class="status-badge"
        [class.active]="isPollActive"
        [class.inactive]="!isPollActive"
      >
        {{ isPollActive ? "Em andamento" : "Encerrada" }}
      </span>
      <span>Início: {{ poll.start_date | date: "dd/MM/yyyy HH:mm" }}</span>
      <span>Término: {{ poll.end_date | date: "dd/MM/yyyy HH:mm" }}</span>
      <span>Criada por: {{ poll.user_email }}</span>
    </div>

    <div class="poll-options">
      <h2>Opções de resposta:</h2>

      <div *ngIf="hasVoted" class="voted-message">
        <i class="fas fa-check-circle"></i> Você já votou nesta enquete:
        <strong>{{ getSelectedOptionText() }}</strong>
        (Opção ID: {{ poll.user_vote }})
      </div>

      <div *ngFor="let option of poll.options" class="option">
        <label [class.selected]="hasVoted && option.id === poll.user_vote">
          <input
            type="radio"
            name="pollOption"
            [value]="option.id"
            [(ngModel)]="selectedOption"
            [disabled]="!isPollActive || !authService.isLoggedIn() || hasVoted"
          />
          {{ option.text }}
          <span
            *ngIf="hasVoted && option.id === poll.user_vote"
            class="your-vote"
          >
            <i class="fas fa-check"></i> Seu voto
          </span>
        </label>
        <span class="votes-count">{{ option.votes_count }} votos</span>
      </div>
    </div>

    <div class="poll-actions">
      <ng-container *ngIf="authService.isLoggedIn(); else notLoggedIn">
        <app-button
          (click)="submitVote()"
          [disabled]="!selectedOption || !isPollActive || hasVoted"
        >
          {{ hasVoted ? "Voto Registrado" : "Votar" }}
        </app-button>
      </ng-container>

      <ng-template #notLoggedIn>
        <app-button (click)="router.navigate(['/login'])" class="login-to-vote">
          Faça login para votar
        </app-button>
      </ng-template>

      <ng-container *ngIf="authService.getCurrentUser()?.id === poll.user_id">
        <app-button routerLink="/polls/{{ poll.id }}/edit" class="edit-button">
          Editar Título
        </app-button>
        <app-button
          (click)="deletePoll()"
          [disabled]="isDeleting"
          class="delete-btn"
        >
          {{ isDeleting ? "Deletando..." : "Deletar Enquete" }}
        </app-button>
      </ng-container>
    </div>
  </div>
</div>
